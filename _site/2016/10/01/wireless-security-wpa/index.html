<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="RootNetSec is a site about journey through the world of network security, pentesting, Linux administration, programming an networking. View to learn more!">
    <meta name="author" content="W3ndige">
    <title>Wireless Security - Root Network Security</title>

    <link rel="canonical" href="http://localhost:4000/2016/10/01/wireless-security-wpa/">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.png">
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//https://fonts.googleapis.com/css?family=Nunito:400,700i" rel="stylesheet">
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Root Network Security" />

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Root Network Security</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/about/">About</a>
                </li>

                <li>
                    <a href="/archive/">Archive</a>
                </li>

                <li>
                    <a href="/contact/">Contact</a>
                </li>

                <li>
                    <a href="/projects/">Projects</a>
                </li>

                <li>
                    <a href="/resources/">Resources</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/wireless-security-wep-header.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Wireless Security</h1>
                    
                    <h2 class="subheading">Theory behind WPA and WPA2</h2>
                    
                    <span class="meta">Posted by W3ndige on October 1, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h1>Introduction</h1>

<p>Hi everyone! Today we're gonna prepare a little bit before the next episode - in which we'll try to hack WPA and WPA Wi-Fi networks. But in order to do that we have to gain better understanding how it works, it's weaknesses (if any) and stronger sides that we shouldn't even try atttacking. Let's jump in to the world of theory! </p>

<h1>What is WPA? </h1>

<p>Due to the lack of security in WEP standard, Wi-Fi Alliance started working on the new standard known as 802.11i. But because the   requirements of this new standard were too high for some devices, in 2003 WPA standard was introduced as a temporary soluton - fast upgrade was possible because of the simple software upgrade. WEP included some of the security features dedicated for 802.11i - called WPA2.  </p>

<p>Main problems that 802.11i wanted to solve</p>

<ul>
<li><b>Protection of shared key</b></li>
<li><b>Security of encryption</b></li>
<li><b>Authentication</b></li>
<li><b>Variability of the key</b></li>
<li><b>Integity</b></li>
</ul>

<h1>RSN</h1>

<p>In order to rebuild the concept of security in wireless networks 802.11i standard introduced <b>Robust Security Network</b>.</p>

<p>In WPA there are 2 possible ways of authentication: </p>

<ul>
<li>Using <b>Pre-Shared-key</b> (PSK) known to the everyone in the network</li>
<li>Using more advanced credentials like own username and password or <b>X.509 certificates</b>. </li>
</ul>

<p>Access to the Wi-Fi using PSK works just like in the WEP, user before connecting to the network must enter a key. This solution, due to the simplicity, is used in homes and is called <b>WPA-Personal</b>, or WPA-PSKA. PSK is entered as 64 hexadecimal numbers, or 8-63 ASCII character.  </p>

<p>Second solution called <b>WPA-Enterprise</b> is using another element - Radius server carrying out the process of authentication, authorization and accounting. That way we gain a few more possibilities: </p>

<ul>
<li>Unique credentials for each user</li>
<li>Possibility to authenticate network to which user is connected (no more fake access point!)</li>
<li>Authentication proceeds before connecting to the network</li>
<li>Ability to control user on the network (time limit, connection to specific VLAN, etc)</li>

</ul>

<p>Firstly, when the user is trying to connect to the network, access point connects to the <b>Radius server</b>, sending him credentials passed by the user. Then Radius decides whether to allow the user to connect or not, and sends this decision to AP. Lastly AP fulfills decision of the server. </p>

<p><b>Important!</b> You have to remember that WPA-Enterprise should not be confused with <b>captive portals</b>, that require user to enter his credentials on WWW website in order to gain access to the Internet. In WPA-Enterprise authentication occurs before connecting the user to the network, while in captive portals it occurs after connection.  </p>

<p>In 802.11i it's essential to create two pairs of keys used to encrypting the traffic - for individual broadcast it's <b>PTK (Pairwise Transient Key)</b> and for group broadcast <b>GTK (Group Transient Key)</b>. Group key must be refreshed every time device disconnects from the network, in order to make impossible to get multicast or broadcast packets.  </p>

<p>In order to create those keys, there was introduced <b>4 way handshake operation</b>, used to create PTK and GTK keys with the PMK.  </p>

<p><img src="/img/wireless-security-wpa/4-way-handshake.png" alt="4-way-handshake" class="img-responsive" /></p>

<ol>

    <li>The AP sends a nonce-value to the STA (ANonce). The client now has all the attributes to construct the PTK.</li>
    <li>The STA sends its own nonce-value (SNonce) to the AP together with a MIC, including authentication, which is really a Message Authentication and Integrity Code (MAIC).</li>
    <li>The AP constructs and sends the GTK and a sequence number together with another MIC. This sequence number will be used in the next multicast or broadcast frame, so that the receiving STA can perform basic replay detection.</li>
    <li>The STA sends a confirmation to the AP.</li>

</ol>

<p>Whenever there will be need to create new GTK key, after the disconnection of the client, access point sends new key and connected client only accepts this change.  </p>

<p>After 4 way handshake client gets PTK and GTK keys, that are essential to encrypt the data. They are constant for each session (if there wasn't key renegotiation). To make it work 802.11i standard introduced CCMP (for WPA it was TKIP which made possible faster implementation). Learn more at:  </p>

<p><a href="https://en.wikipedia.org/wiki/Temporal_Key_Integrity_Protocol" title="TKIP">TKIP</a><br />
<a href="https://en.wikipedia.org/wiki/CCMP" title="CCMP">CCMP</a><br /></p>

<h1>Security</h1>

<ul>
<li>Only eavesdropping the broadcast won't allow us to decrypt it due to the changes in encryption key (while in WEP you only had to capture big number of packets to crack the password). </li>

<li>Possesion of captured broadcast without the handshake won't let us decrypt it. </li>

<li>Fix in the IV collision</li>

<li>Use of algorithm insusceptible to the related key attack. </li>

<li>Better integrity of the packets</li>

<li>More advanced authentication mechanisms using 802.1X.</li>
</ul>
<h1>But is WPA vulnerable?</h1>

<p>Yes, and here are the most important types of attacks. </p>

<h3>Brute force attacks</h3>

<p>Due to the fact that PTK key, used to protect the broadcast is created using PSK and some data sent through handshake. </p>

<p>Even if we don't know the PSK, but we can capture additional data used during the handshake, we can still try to perform a brute force attack based on trying different PSK values, then calculating PMK and PTK and checking if the value is correct</p>

<p>But because of the size of PSK's value (9-63 ASCII characters) trying out whole number of combinations is almost impossible. In real life this attack is performed using dictionary attack which is a lot faster since trying out all the words in dictionary can be done in a few days, or even faster. There is only one flaw in this attack - if the password isn't in the dictionary - then we will not succeed. </p>

<p>Alternative to this, we can try attacking using rainbow tables. Because hashing algorithms create hashes of same and always equal size it's very hard to avoid phenomenon called collision. Collision occurs when two different inputs passed to the hashing algorithms produce same output. It makes the process of attacking even faster as we're using precomputed rainbow tables (not hashing in 'air'), and we only have to check whether each hash in the table works. Still we don't have certainity to succeed.  </p>

<p>Additionaly, in 2007, new vulnerability was described called "short packed spoofing", allowing us to decrypt short packets like ARP, but it didn't result in capturing the PSK key - only the key stream used to encrypt the packet, allowing us to inject few packets into the network, resulting in for example sending data from the user to the Internet.  </p>

<h3>Fuzzing</h3>

<p>Security of the wireless networks also depends on the software handling this work (drivers, libraries etc). Because of the fact that network architecture is getting more and more complicated - code is also getting much more complex which may result in flaws that attacker can use to exploit. </p>

<hr />

<p>I hope that you gained better understanding of how WPA and WPA2 works. In next part we're going to actually try and attack protected wireless network. Thanks for reading and keep tuned for more! </p>

<p>~ Stay safe! </p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2016/09/25/wireless-security-wep/" data-toggle="tooltip" data-placement="top" title="Wireless Security">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2016/10/15/euler-truncatable-primes/" data-toggle="tooltip" data-placement="top" title="Problem 37 - Truncatable Primes">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/w3ndige">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:w3ndige@protonmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; RootNetSec 2016 - 2017</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
