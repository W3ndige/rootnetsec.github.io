<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="RootNetSec is a site about journey through the world of network security, pentesting, Linux administration, programming an networking. View to learn more!">
    <meta name="author" content="W3ndige">
    <title>Overthewire.org - Natas - Root Network Security</title>

    <link rel="canonical" href="http://localhost:4000/2016/12/25/overthewire.org-natas/">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.png">
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//https://fonts.googleapis.com/css?family=Nunito:400,700i" rel="stylesheet">
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Root Network Security" />

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Root Network Security</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/about/">About</a>
                </li>

                <li>
                    <a href="/archive/">Archive</a>
                </li>

                <li>
                    <a href="/contact/">Contact</a>
                </li>

                <li>
                    <a href="/projects/">Projects</a>
                </li>

                <li>
                    <a href="/resources/">Resources</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/overthewire-header.png')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Overthewire.org - Natas</h1>
                    
                    <h2 class="subheading">Write-Up Part 1</h2>
                    
                    <span class="meta">Posted by W3ndige on December 25, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h1>Introduction</h1>

<p>Welcome back to another OverTheWire wargame called "Leviathan" - which is made only of tasks connected to web security. As the number of exercises is very big (33 at the time of publishing this post), I will break it down in a few smaller parts. Without wasting your time, let's get started! </p>

<h1>0</h1>

<p>Firstly, we are greeted with this message: </p>
<pre>You can find the password for the next level on this page.</pre>
<p>As you may suspect, password is hidden somewhere in the source code of the website. Let's take a look: </p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span><span class="nt">&gt;</span>
You can find the password for the next level on this page.

<span class="c">&lt;!--The password for natas1 is *********************** --&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<p>There it is, commented out. Now let's jump into the next level.</p>

<h1>1</h1>

<p>This time we have more 'serious' protection going on.</p>
<pre>You can find the password for the next level on this page, but rightclicking has been blocked!</pre>
<p>One of the ways to bypass this protection, is to enter <b>view-source:</b> before the URL of the website. </p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span><span class="nt">&gt;</span>
You can find the password for the
next level on this page, but rightclicking has been blocked!

<span class="c">&lt;!--The password for natas2 is *********************** --&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<h1>2</h1>

<p>This time, we have to look somewhere outside of the source code. </p>
<pre>There is nothing on this page</pre>

<p>The first thing that comes to my mind is <b>robots.txt</b> - they sometimes contain very useful information. Unfortunately, it did not work out this time. But there was something that concerned me. </p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span><span class="nt">&gt;</span>
There is nothing on this page
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"files/pixel.png"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<p>What is this <b>pixel.png</b>? It's in the directory called files, maybe we'll find something more useful there.</p>

<p>Great, apart from pixel.png we have <b>users.txt</b> containing pass for the next one!</p>

<pre>
# username:password
alice:BYNdCesZqW
bob:jw2ueICLvT
charlie:G5vCxkVV3m
natas3:***********************
eve:zo4mJWyNj2
mallory:9urtcpzBmH
</pre>

<h1>3</h1>

<p>Once again: </p>
<pre>There is nothing on this page</pre>

<p>But!</p>
<p>This time we have a clue in <b>robots.txt</b>. I knew it will help at some point!</p>
<pre>
User-agent: *
Disallow: /s3cr3t/
</pre>

<p>Going under this directory lets us view another users.txt with password to the next one. </p>
<pre>
natas4:***********************
</pre>

<h1>4</h1>

<p>Oh, something new!</p>
<pre>Access disallowed. You are visiting from "" while authorized users should come only from "http://natas5.natas.labs.overthewire.org/"</pre>

<p>It must be something with HTTP referer, changing it's property (spoofing) may allow me to enter. </p>

<p>After quick googling, I came up with this plugin for Chrome - <a href="https://chrome.google.com/webstore/detail/referer-control/acehenlbileblompmkkoimgobmcdkgeb">Referer Control</a>. After changing the referer to this, provided in instructions, and refreshing the page I got the pass to the next one. </p>

<pre>
Access granted. The password for natas5 is iX6IOfmpN7AYOQGPwtn3fXpbaJVJcHfq
</pre>

<h1>5</h1>

<p>But, how can I log in? :D</p>

<pre>Access disallowed. You are not logged in</pre>

<p>Actually, this level was very easy - using <a href="http://www.editthiscookie.com/">EditThisCookie</a> I was able to change the value of loggedin cookie from 0 to 1, resulting in ability to view the password. </p>

<pre>
Access granted. The password for natas6 is ***********************
</pre>

<h1>6</h1>

<p>This time we've got simple form, with ability to view it's source code. </p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?</span>

<span class="k">include</span> <span class="s2">"includes/secret.inc"</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$secret</span> <span class="o">==</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">print</span> <span class="s2">"Access granted. The password for natas7 is &lt;censored&gt;"</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">print</span> <span class="s2">"Wrong secret"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>Actually, we don't have to analyze whole code, what's essential is the <b>include</b> part and since <b>$secret</b> is assigned nowhere in this code I can assume, that it's in the secret.inc file. Let's check it!</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?</span>
<span class="nv">$secret</span> <span class="o">=</span> <span class="s2">"FOEIUWGHFEEUHOFUOIU"</span><span class="p">;</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>Now last thing is to enter the secret into the input form. </p>
<p>Great, it works!</p>

<pre>
Access granted. The password for natas7 is ***********************
</pre>

<h1>7</h1>

<p>In this level we have simple structure of the website - clicking the elements in the menu changes the content of the website. </p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span><span class="nt">&gt;</span>

<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"index.php?page=home"</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"index.php?page=about"</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;br&gt;</span>
this is the about page

<span class="c">&lt;!-- hint: password for webuser natas8 is in /etc/natas_webpass/natas8 --&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<p>Ok, we have this hint. Let's try to break this system and get access to /etc/natas_webpass/natas8</p>

<p>Actualy I didn't have to break it, simple entering this in URL like <b>index.php?page=/etc/natas_webpass/natas8</b> allowed me to view the file. </p>

<pre>
***********************
</pre>

<h1>8</h1>

<p>Another level, another form.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?</span>

<span class="nv">$encodedSecret</span> <span class="o">=</span> <span class="s2">"3d3d516343746d4d6d6c315669563362"</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">encodeSecret</span><span class="p">(</span><span class="nv">$secret</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nb">strrev</span><span class="p">(</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$secret</span><span class="p">)));</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">encodeSecret</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">])</span> <span class="o">==</span> <span class="nv">$encodedSecret</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s2">"Access granted. The password for natas9 is &lt;censored&gt;"</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s2">"Wrong secret"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>Let's break down this process - firstly script takes input entered in form, then with function <b>encodeSecret</b> it converts binary to hex, reverses this string and encodes with base64. What we have to do here is to reverse this process, which can be done with php. </p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">w3ndige@w3ndige ~ <span class="nv">$ </span>php -r <span class="s1">'echo base64_decode(strrev(hex2bin("3d3d516343746d4d6d6c315669563362")));'</span></code></pre></figure>

<p>This one liner produces the correct secret, which after entering into the form gives pass to the nex level. </p>

<pre>
Access granted. The password for natas9 is ***********************
</pre>

<h1>9</h1>

<p>This time we have something new - form searching in an dictionary. Let's check the source code. </p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?</span>
<span class="nv">$key</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"needle"</span><span class="p">,</span> <span class="nv">$_REQUEST</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$key</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"needle"</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$key</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">passthru</span><span class="p">(</span><span class="s2">"grep -i </span><span class="nv">$key</span><span class="s2"> dictionary.txt"</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>Actually, what this script does is very dangerous. We know that grep is command line function searching through the text files. But what, if we have entered semicolon and then another command? Acutally, you can see it working by entering <b>;ls- la</b> in search form.  </p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">-rw-r----- 1 natas9 natas9 460878 Jun 25  2016 dictionary.txt</code></pre></figure>

<p>Great, lets view the password by entering ;cat /etc/natas_webpass/natas10/, as it's also location of all passwords, which was stated in the beginning. </p>

<pre>
Output:
***********************

African
Africans
Allah
Allah's
</pre>

<p>Let's move to the next one!</p>

<h1>10</h1>

<p>This time we have the updated version of the script from the last one, filtering for certain characters.  </p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">&lt;?
<span class="nv">$key</span> <span class="o">=</span> <span class="s2">""</span>;

<span class="k">if</span><span class="o">(</span>array_key_exists<span class="o">(</span><span class="s2">"needle"</span>, <span class="nv">$_REQUEST</span><span class="o">))</span> <span class="o">{</span>
    <span class="nv">$key</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="o">[</span><span class="s2">"needle"</span><span class="o">]</span>;
<span class="o">}</span>

<span class="k">if</span><span class="o">(</span><span class="nv">$key</span> !<span class="o">=</span> <span class="s2">""</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span>preg_match<span class="o">(</span><span class="s1">'/[;|&amp;]/'</span>,<span class="nv">$key</span><span class="o">))</span> <span class="o">{</span>
        print <span class="s2">"Input contains an illegal character!"</span>;
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        passthru<span class="o">(</span><span class="s2">"grep -i </span><span class="nv">$key</span><span class="s2"> dictionary.txt"</span><span class="o">)</span>;
    <span class="o">}</span>
<span class="o">}</span>
?&gt;</code></pre></figure>

<p>We have to find the way to execute this commands in a different way. And actually, after learning a lot about PHP I remembered that <b>.</b> concatenates 2 strings. So let's do this: <b>. /etc/natas_webpass/natas11</b></p>

<p>Which actually produces the output! I tried to do this also with HTML entities firstly, but unfortunately it did not work out.  </p>

<pre>
/etc/natas_webpass/natas11:***********************
dictionary.txt:African
dictionary.txt:Africans
dictionary.txt:Allah
dictionary.txt:Allah's
</pre>

<hr />

<p>And that's the point where I had to end this part of Natas exercises. I'll come back soon with another part, as they are really interesting and completely different from others at OverTheWire. </p>

<p>See you in the next one!</p>

<p>~ Stay safe!</p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2016/12/14/what-has-happened/" data-toggle="tooltip" data-placement="top" title="Summary of 2016">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2017/01/01/overthewire.org-narnia-1/" data-toggle="tooltip" data-placement="top" title="Overthewire.org - Narnia 0 -> 1">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/w3ndige">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:w3ndige@protonmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; RootNetSec 2016 - 2017</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
